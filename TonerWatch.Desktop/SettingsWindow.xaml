<Window x:Class="TonerWatch.Desktop.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Настройки - TonerWatch" 
        Height="850" Width="900"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="#0F172A"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType"
        TextOptions.TextHintingMode="Fixed"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True">
    
    <Window.Resources>
        <Style x:Key="ModernTabStyle" TargetType="TabItem">
            <Setter Property="Background" Value="#1E293B"/>
            <Setter Property="Foreground" Value="#94A3B8"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="Medium"/>
        </Style>
        
        <Style x:Key="SectionCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#1E293B"/>
            <Setter Property="CornerRadius" Value="12"/>
            <Setter Property="Padding" Value="24"/>
            <Setter Property="Margin" Value="0,0,0,20"/>
            <Setter Property="BorderBrush" Value="#334155"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>
        
        <Style x:Key="ModernComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Background" Value="#374151"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#4B5563"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="36"/>
        </Style>
        
        <Style x:Key="ModernTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#374151"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#4B5563"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Height" Value="36"/>
        </Style>
        
        <Style x:Key="ModernCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Margin" Value="0,8"/>
        </Style>
        
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#14B8A6"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="Margin" Value="4"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#0F766E"/>
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="1.05" ScaleY="1.05" CenterX="0.5" CenterY="0.5"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="RenderTransform">
                        <Setter.Value>
                            <ScaleTransform ScaleX="0.95" ScaleY="0.95" CenterX="0.5" CenterY="0.5"/>
                        </Setter.Value>
                    </Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#1E293B" Padding="30,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <Border Grid.Column="0" Background="#14B8A6" CornerRadius="12" Width="48" Height="48" 
                      VerticalAlignment="Center" Margin="0,0,16,0">
                    <TextBlock Text="⚙️" FontSize="24" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>
                
                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                    <TextBlock Text="Настройки TonerWatch" FontSize="24" FontWeight="Bold" Foreground="White"/>
                    <TextBlock Text="Конфигурация мониторинга принтеров и уведомлений" FontSize="14" 
                             Foreground="#94A3B8" Margin="0,4,0,0"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Main Content with TabControl -->
        <TabControl Grid.Row="1" Padding="30" Background="#0F172A" BorderThickness="0">
            <TabItem Header="Общие" Style="{StaticResource ModernTabStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- General Settings -->
                        <Border Style="{StaticResource SectionCardStyle}">
                            <StackPanel>
                                <TextBlock Text="📋 Общие настройки" FontSize="18" FontWeight="Bold" 
                                         Foreground="White" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Интервал обновления:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="RefreshIntervalComboBox" Grid.Column="1" SelectedIndex="2" Style="{StaticResource ModernComboBoxStyle}"/>
                                </Grid>
                                
                                <!-- Custom interval input -->
                                <Grid x:Name="CustomIntervalGrid" Margin="0,0,0,16" Visibility="Collapsed">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Пользовательский интервал:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <TextBox x:Name="CustomIntervalTextBox" Grid.Column="1" Text="60" Style="{StaticResource ModernTextBoxStyle}" 
                                           Margin="0,0,8,0" TextAlignment="Right"/>
                                    <TextBlock Grid.Column="2" Text="секунд" Foreground="#94A3B8" VerticalAlignment="Center" FontSize="13"/>
                                </Grid>
                                
                                <!-- Discovery interval -->
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Интервал поиска:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="DiscoveryIntervalComboBox" Grid.Column="1" SelectedIndex="2" Style="{StaticResource ModernComboBoxStyle}"/>
                                </Grid>
                                
                                <CheckBox x:Name="StartWithWindowsCheckBox" Content="Запускать с Windows" Style="{StaticResource ModernCheckBoxStyle}"/>
                                <CheckBox x:Name="MinimizeToTrayCheckBox" Content="Сворачивать в системный трей" Style="{StaticResource ModernCheckBoxStyle}"/>
                                <CheckBox x:Name="ShowDesktopNotificationsCheckBox" Content="Показывать уведомления на рабочем столе" IsChecked="True" Style="{StaticResource ModernCheckBoxStyle}"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Alert Settings -->
                        <Border Style="{StaticResource SectionCardStyle}">
                            <StackPanel>
                                <TextBlock Text="🚨 Пороги уведомлений" FontSize="18" FontWeight="Bold" 
                                         Foreground="White" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,20">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Критический уровень:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <Slider x:Name="CriticalSlider" Grid.Column="1" Minimum="0" Maximum="25" Value="10" 
                                          TickFrequency="5" IsSnapToTickEnabled="True" Margin="0,0,12,0"
                                          ValueChanged="CriticalSlider_ValueChanged"/>
                                    <TextBlock x:Name="CriticalValueText" Grid.Column="2" Text="10%" Foreground="#EF4444" 
                                             VerticalAlignment="Center" FontWeight="Bold" FontSize="13"/>
                                </Grid>

                                <Grid Margin="0,0,0,20">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="60"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Уровень предупреждения:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <Slider x:Name="WarningSlider" Grid.Column="1" Minimum="10" Maximum="50" Value="25" 
                                          TickFrequency="5" IsSnapToTickEnabled="True" Margin="0,0,12,0"
                                          ValueChanged="WarningSlider_ValueChanged"/>
                                    <TextBlock x:Name="WarningValueText" Grid.Column="2" Text="25%" Foreground="#F59E0B" 
                                             VerticalAlignment="Center" FontWeight="Bold" FontSize="13"/>
                                </Grid>
                                
                                <CheckBox x:Name="WindowsNotificationsCheckBox" Content="🔔 Уведомления Windows" IsChecked="True" Style="{StaticResource ModernCheckBoxStyle}"/>
                                <CheckBox x:Name="EmailNotificationsCheckBox" Content="📧 Email уведомления" Style="{StaticResource ModernCheckBoxStyle}"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Network Settings -->
                        <Border Style="{StaticResource SectionCardStyle}">
                            <StackPanel>
                                <TextBlock Text="🌐 Сетевые настройки" FontSize="18" FontWeight="Bold" 
                                         Foreground="White" Margin="0,0,0,16"/>
                                
                                <!-- IP Range Configuration -->
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Диапазоны IP-адресов:" 
                                             Foreground="White" VerticalAlignment="Top" FontSize="13" Margin="0,0,10,0"/>
                                    <StackPanel Grid.Column="1">
                                        <TextBox x:Name="SubnetRangeTextBox" Text="192.168.0.0/24" Style="{StaticResource ModernTextBoxStyle}" 
                                               Margin="0,0,0,8" AcceptsReturn="True" Height="80" TextWrapping="Wrap"
                                               ToolTip="Введите диапазоны IP-адресов, разделенные запятыми или новыми строками"/>
                                        
                                        <!-- IP Range Validation Message -->
                                        <TextBlock x:Name="IpRangeValidationText" Text="" FontSize="12" 
                                                 Foreground="#F59E0B" Margin="0,0,0,8" Visibility="Collapsed"/>
                                        
                                        <!-- Visual Representation of Network Segments -->
                                        <Border Background="#374151" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                            <StackPanel>
                                                <TextBlock Text="📊 Визуализация сетевых сегментов" FontSize="12" 
                                                         Foreground="#94A3B8" Margin="0,0,0,8"/>
                                                <ItemsControl x:Name="NetworkSegmentsVisualization">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Border Background="#1E293B" CornerRadius="6" Padding="8" Margin="0,0,0,4">
                                                                <Grid>
                                                                    <Grid.ColumnDefinitions>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                        <ColumnDefinition Width="*"/>
                                                                        <ColumnDefinition Width="Auto"/>
                                                                    </Grid.ColumnDefinitions>
                                                                    <Ellipse Width="8" Height="8" Fill="#14B8A6" 
                                                                           VerticalAlignment="Center" Margin="0,0,8,0"/>
                                                                    <TextBlock Grid.Column="1" Text="{Binding}" FontSize="12" 
                                                                             Foreground="White" VerticalAlignment="Center"/>
                                                                    <TextBlock Grid.Column="2" Text="✓" FontSize="12" 
                                                                             Foreground="#10B981" VerticalAlignment="Center" Margin="8,0,0,0"/>
                                                                </Grid>
                                                            </Border>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </Border>
                                        
                                        <!-- Common Network Presets -->
                                        <TextBlock Text="퀵 Настройки:" FontSize="12" Foreground="#94A3B8" Margin="0,8,0,4"/>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="Локальная сеть (192.168.1.0/24)" Style="{StaticResource ActionButtonStyle}" 
                                                   FontSize="11" Padding="8,4" Margin="0,0,8,0" Click="PresetLocalNetwork_Click"/>
                                            <Button Content="Класс C (192.168.0.0/16)" Style="{StaticResource ActionButtonStyle}" 
                                                   FontSize="11" Padding="8,4" Margin="0,0,8,0" Click="PresetClassC_Click"/>
                                            <Button Content="Очистить" Style="{StaticResource ActionButtonStyle}" 
                                                   Background="#6B7280" FontSize="11" Padding="8,4" Click="ClearIpRanges_Click"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                                
                                <CheckBox x:Name="AutoDiscoveryCheckBox" Content="Автоматическое обнаружение новых устройств" IsChecked="True" Style="{StaticResource ModernCheckBoxStyle}"/>
                                <CheckBox x:Name="SnmpCheckBox" Content="Включить SNMP мониторинг" IsChecked="True" Style="{StaticResource ModernCheckBoxStyle}"/>
                                
                                <!-- SNMP Configuration -->
                                <TextBlock Text="📡 Настройки SNMP" FontSize="16" FontWeight="Bold" 
                                         Foreground="White" Margin="0,20,0,16"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Версия SNMP:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <ComboBox x:Name="SnmpVersionComboBox" Grid.Column="1" SelectedIndex="1" Style="{StaticResource ModernComboBoxStyle}">
                                        <ComboBoxItem Content="SNMPv1"/>
                                        <ComboBoxItem Content="SNMPv2c"/>
                                        <ComboBoxItem Content="SNMPv3"/>
                                    </ComboBox>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Community String:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <TextBox x:Name="SnmpCommunityTextBox" Grid.Column="1" Text="public" Style="{StaticResource ModernTextBoxStyle}"/>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Таймаут SNMP:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <TextBox x:Name="SnmpTimeoutTextBox" Grid.Column="1" Text="5000" Style="{StaticResource ModernTextBoxStyle}" 
                                           TextAlignment="Right"/>
                                </Grid>
                                
                                <!-- Performance Settings -->
                                <TextBlock Text="⚡ Настройки производительности" FontSize="16" FontWeight="Bold" 
                                         Foreground="White" Margin="0,20,0,16"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Макс. параллельных сканов:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <TextBox x:Name="MaxConcurrentScansTextBox" Grid.Column="1" Text="50" Style="{StaticResource ModernTextBoxStyle}" 
                                           Margin="0,0,8,0" TextAlignment="Right"/>
                                    <TextBlock Grid.Column="2" Text="сканов" Foreground="#94A3B8" VerticalAlignment="Center" FontSize="13"/>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Таймаут сканирования:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <TextBox x:Name="ScanTimeoutTextBox" Grid.Column="1" Text="3" Style="{StaticResource ModernTextBoxStyle}" 
                                           Margin="0,0,8,0" TextAlignment="Right"/>
                                    <TextBlock Grid.Column="2" Text="секунд" Foreground="#94A3B8" VerticalAlignment="Center" FontSize="13"/>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Повторы сканирования:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <TextBox x:Name="ScanRetriesTextBox" Grid.Column="1" Text="1" Style="{StaticResource ModernTextBoxStyle}" 
                                           TextAlignment="Right"/>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="200"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Задержка между повторами:" 
                                             Foreground="White" VerticalAlignment="Center" FontSize="13" Margin="0,0,10,0"/>
                                    <TextBox x:Name="ScanRetryDelayTextBox" Grid.Column="1" Text="1000" Style="{StaticResource ModernTextBoxStyle}" 
                                           Margin="0,0,8,0" TextAlignment="Right"/>
                                    <TextBlock Grid.Column="2" Text="мс" Foreground="#94A3B8" VerticalAlignment="Center" FontSize="13"/>
                                </Grid>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
            
            <!-- Network Segments Tab -->
            <TabItem Header="Сетевые сегменты" Style="{StaticResource ModernTabStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <!-- Network Segments Management -->
                        <Border Style="{StaticResource SectionCardStyle}">
                            <StackPanel>
                                <TextBlock Text="🌐 Управление сетевыми сегментами" FontSize="18" FontWeight="Bold" 
                                         Foreground="White" Margin="0,0,0,16"/>
                                
                                <!-- Segment List -->
                                <TextBlock Text="Существующие сегменты:" FontSize="14" FontWeight="Medium" 
                                         Foreground="White" Margin="0,0,0,8"/>
                                
                                <Border Background="#374151" CornerRadius="8" Padding="12" Margin="0,0,0,16">
                                    <StackPanel>
                                        <ItemsControl x:Name="NetworkSegmentsList">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border Background="#1E293B" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                                        <Grid>
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            
                                                            <StackPanel Grid.Column="0">
                                                                <TextBlock Text="{Binding Name}" FontSize="14" FontWeight="Bold" 
                                                                         Foreground="White" Margin="0,0,0,4"/>
                                                                <TextBlock Text="{Binding IpRange}" FontSize="12" 
                                                                         Foreground="#94A3B8" Margin="0,0,0,4"/>
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="Статус: " FontSize="11" Foreground="#94A3B8"/>
                                                                    <TextBlock Text="{Binding IsEnabled, Converter={StaticResource BooleanToStatusConverter}}" 
                                                                             FontSize="11" Foreground="{Binding IsEnabled, Converter={StaticResource BooleanToColorConverter}}"/>
                                                                    <TextBlock Text=" | Последний скан: " FontSize="11" Foreground="#94A3B8" Margin="8,0,0,0"/>
                                                                    <TextBlock Text="{Binding LastScanTime, StringFormat='{}{0:dd.MM.yyyy HH:mm}'}" 
                                                                             FontSize="11" Foreground="#94A3B8"/>
                                                                </StackPanel>
                                                            </StackPanel>
                                                            
                                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                                <Button Content="✏️" Width="30" Height="30" Margin="0,0,4,0"
                                                                       Background="#3B82F6" Foreground="White" BorderThickness="0"
                                                                       Click="EditSegmentButton_Click" Tag="{Binding}"/>
                                                                <Button Content="🗑️" Width="30" Height="30"
                                                                       Background="#EF4444" Foreground="White" BorderThickness="0"
                                                                       Click="DeleteSegmentButton_Click" Tag="{Binding}"/>
                                                            </StackPanel>
                                                        </Grid>
                                                    </Border>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                        
                                        <TextBlock x:Name="NoSegmentsText" Text="Нет настроенных сетевых сегментов" 
                                                 FontSize="12" Foreground="#94A3B8" HorizontalAlignment="Center" 
                                                 Margin="0,16" Visibility="Collapsed"/>
                                    </StackPanel>
                                </Border>
                                
                                <!-- Add New Segment Button -->
                                <Button Content="➕ Добавить сетевой сегмент" Style="{StaticResource ActionButtonStyle}" 
                                       HorizontalAlignment="Left" Click="AddSegmentButton_Click"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Segment Configuration Panel -->
                        <Border x:Name="SegmentConfigPanel" Style="{StaticResource SectionCardStyle}" Visibility="Collapsed">
                            <StackPanel>
                                <TextBlock x:Name="SegmentConfigTitle" Text="Добавить новый сегмент" FontSize="18" FontWeight="Bold" 
                                         Foreground="White" Margin="0,0,0,16"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Название:" Foreground="White" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBox x:Name="SegmentNameTextBox" Grid.Column="1" Style="{StaticResource ModernTextBoxStyle}"/>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Описание:" Foreground="White" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBox x:Name="SegmentDescriptionTextBox" Grid.Column="1" Style="{StaticResource ModernTextBoxStyle}"/>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="IP диапазон:" Foreground="White" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBox x:Name="SegmentIpRangeTextBox" Grid.Column="1" Style="{StaticResource ModernTextBoxStyle}"
                                           ToolTip="Поддерживаются форматы: CIDR (192.168.1.0/24), диапазоны (192.168.1.1-254), несколько через запятую"/>
                                </Grid>
                                
                                <CheckBox x:Name="SegmentEnabledCheckBox" Content="Сегмент включен" IsChecked="True" 
                                        Style="{StaticResource ModernCheckBoxStyle}"/>
                                
                                <TextBlock Text="🔧 Настройки сканирования" FontSize="16" FontWeight="Bold" 
                                         Foreground="White" Margin="0,20,0,16"/>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Таймаут:" Foreground="White" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBox x:Name="SegmentTimeoutTextBox" Grid.Column="1" Text="3" Style="{StaticResource ModernTextBoxStyle}" 
                                           TextAlignment="Right" Margin="0,0,8,0"/>
                                    <TextBlock Grid.Column="2" Text="секунд" Foreground="#94A3B8" VerticalAlignment="Center" FontSize="13"/>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Макс. сканов:" Foreground="White" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBox x:Name="SegmentMaxScansTextBox" Grid.Column="1" Text="50" Style="{StaticResource ModernTextBoxStyle}" 
                                           TextAlignment="Right"/>
                                </Grid>
                                
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Повторы:" Foreground="White" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBox x:Name="SegmentRetriesTextBox" Grid.Column="1" Text="1" Style="{StaticResource ModernTextBoxStyle}" 
                                           TextAlignment="Right"/>
                                </Grid>
                                
                                <CheckBox x:Name="SegmentSnmpCheckBox" Content="Включить SNMP" IsChecked="True" 
                                        Style="{StaticResource ModernCheckBoxStyle}"/>
                                
                                <CheckBox x:Name="SegmentScheduleCheckBox" Content="Пользовательское расписание" 
                                        Style="{StaticResource ModernCheckBoxStyle}" Checked="SegmentScheduleCheckBox_Checked" 
                                        Unchecked="SegmentScheduleCheckBox_Unchecked"/>
                                
                                <Grid x:Name="SegmentScheduleGrid" Margin="0,0,0,16" Visibility="Collapsed">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="Расписание:" Foreground="White" VerticalAlignment="Center" FontSize="13"/>
                                    <TextBox x:Name="SegmentScheduleTextBox" Grid.Column="1" Text="every 60 minutes" Style="{StaticResource ModernTextBoxStyle}"
                                           ToolTip="Формат: 'every X minutes' или cron-выражение"/>
                                </Grid>
                                
                                <CheckBox x:Name="SegmentAvoidPeakCheckBox" Content="Избегать пиковых часов (9-17)" 
                                        Style="{StaticResource ModernCheckBoxStyle}"/>
                                
                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,20,0,0">
                                    <Button Content="❌ Отмена" Margin="0,0,12,0" 
                                           Background="#374151" Foreground="White" BorderThickness="0" 
                                           Padding="16,8" FontSize="13" Click="CancelSegmentButton_Click"/>
                                    <Button Content="✅ Сохранить" 
                                           Background="#14B8A6" Foreground="White" BorderThickness="0" 
                                           Padding="16,8" FontSize="13" FontWeight="Medium" Click="SaveSegmentButton_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>
        
        <!-- Bottom Buttons -->
        <Border Grid.Row="2" Background="#1E293B" Padding="30,16">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="🔄 Сбросить настройки" Margin="0,0,16,0" 
                       Background="#6B7280" Foreground="White" BorderThickness="0" 
                       Padding="16,8" FontSize="13" Click="ResetButton_Click"/>
                <Button Content="❌ Отмена" Margin="0,0,12,0" 
                       Background="#374151" Foreground="White" BorderThickness="0" 
                       Padding="16,8" FontSize="13" Click="CancelButton_Click"/>
                <Button Content="✅ Сохранить" 
                       Background="#14B8A6" Foreground="White" BorderThickness="0" 
                       Padding="16,8" FontSize="13" FontWeight="Medium" Click="SaveButton_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>